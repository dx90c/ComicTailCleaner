### **ComicTailCleaner 開發計畫與交接文件**

**致所有協作者 (包括 AI)：**

您好，歡迎加入 ComicTailCleaner 專案。為確保所有開發工作都能在一個清晰、統一的框架下進行，請在開始任何工作前，仔細閱讀本文件。

本文件包含了專案的長期開發路線圖、未來版本的實現細節規劃，以及我們為確保協作效率而制定的程式碼分段交付策略。

---

### **一、開發路線圖 (Development Roadmap)**

本專案採用語義化版本號。`v13.x` 系列完成了從混亂到穩定的UI架構探索，而 `v14.x` 系列則專注於在穩定架構上，實現高性能的核心引擎與完善的使用者體驗。

#### **v13.x 系列 (UI架構探索與穩定)**

*   **v13.1.0 (已完成)**:
    *   **核心**: 引入了早期、較不穩定的父子聯動勾選UI模型，並修復了增量掃描的性能問題。
*   **v13.3.0 (已完成 - 重要里程碑)**:
    *   **核心**: 確立了**UI架構基線**。通過戰略性地簡化交互，實現了一個絕對穩定的、採用「虛擬父項 + 平級子項」模型的UI框架，為後續所有開發奠定了堅實基礎。

#### **v14.x 系列 (核心引擎革命與體驗完善)**

*   **v14.0.0 (已完成 - 重要里程碑)**:
    *   **核心**: **實現了完整的群組交互功能**。在 v13.3.0 的穩定基線上，成功地、無Bug地實現了父項的「三態聚合狀態顯示 (`☐`/`☑`/`◪`)」和「群組聯動勾選」功能。
*   **v14.1.0 ~ v14.2.1 (已完成 - 當前版本)**:
    *   **核心**: **核心比對引擎革命**。引入了高性能、高精度的**LSH雙哈希 (pHash+wHash) 驗證引擎**，並採用「廣告集團搜索」策略，從根本上解決了臨界區誤報、漏報以及相似廣告導致重複結果的問題。
    *   **穩定性**: 完成了對UI佈局跳動、數據污染、路徑正規化、鍵盤導航、檔案刪除邏輯等一系列關鍵問題的**全面修復**。

#### **v15.x 系列 (未來長期目標)**

*   **v15.0.0 (待規劃)**:
    *   **核心目標**: **GUI 框架現代化遷移**。
    *   **待實現**: 評估並將目前的 `tkinter` GUI 框架，遷移至更現代、功能更強大的框架（如 `PyQt6` 或 `PySide6`），以獲得更佳的跨平台原生體驗、更靈活的佈局能力和更豐富的元件庫。
*   **v15.1.0 (待規劃)**:
    *   **核心目標**: **錯誤恢復與使用者自訂功能**。
    *   **待實現**:
        *   **中斷點續傳**: 允許使用者從上次意外中斷的地方繼續掃描，而非從頭開始。
        *   **使用者回饋學習**: 引入一種機制，允許使用者將被誤判的結果標記為「不相似」，程式應記住這些判斷，並在未來的掃描中降低它們的匹配權重。

---

### **二、實現細節 (未來版本)**

#### **v15.0.0: GUI 框架遷移 (PyQt6/PySide6)**

*   **目標**: 在**不改變任何後端邏輯** (`ImageComparisonEngine`, 快取管理等) 的前提下，將所有UI相關的程式碼從 `tkinter` 翻譯為 `PyQt6`。
*   **實現細節**:
    1.  **非同步框架**: 使用 `QThread` 和 `pyqtSignal` 來替代現有的 `threading.Thread` 和 `Queue`，以實現更優雅的線程通信。
    2.  **主視窗**: 使用 `QMainWindow`, `QSplitter`, `QStatusBar`, `QProgressBar` 等元件重新搭建主介面。
    3.  **結果列表**: 使用 `QTreeWidget` 替代 `ttk.Treeview`，並重新實現所有項目填充、勾選狀態更新、展開/收合等邏輯。
    4.  **圖片預覽**: 使用 `QLabel` 配合 `QPixmap` 實現高效的異步圖片載入和顯示。
    5.  **設定視窗**: 使用 `QDialog` 配合 `QFormLayout` 等佈局管理器，重新創建一個更美觀、佈局更合理的設定面板。

---

### **三、程式碼分段交付策略 (Code Segmentation Strategy)**

為確保在任何協作環境下（包括與AI協作）都能進行高效、無損的程式碼交付，所有提交**必須嚴格遵守**以下**新三段交付藍圖**。此藍圖基於 v14.2.1 的穩定結構制定。

#### **第一部分：後端基礎設施與數據採集**
*   **內容**: 從檔案頭 (`# =================...`) 到 `get_files_to_process` 函式結束。
*   **邏輯單元**: 涵蓋所有非GUI的基礎設施，包括所有導入、常數、工具函式、多進程 Workers、快取管理類，以及檔案掃描與收集邏輯。
*   **交付標誌**: 交付一個功能完整的數據採集後端。

#### **第二部分：核心比對引擎與GUI框架搭建**
*   **內容**: 從 `# === 10. 核心比對引擎 ===` 開始，到 `MainWindow` 類別的 `_reset_control_buttons` 方法結束。
*   **邏輯單元**: 涵蓋核心的 `ImageComparisonEngine` 類，以及所有GUI視窗 (`SettingsGUI`, `MainWindow`) 的**結構定義、元件佈局和控制按鈕**的實現。
*   **交付標誌**: 交付一個擁有比對能力和完整靜態介面的應用程式框架。

#### **第三部分：GUI事件處理、異步邏輯與應用程式入口**
*   **內容**: 從 `MainWindow` 類別的 `_check_queues` 方法開始，到檔案的最末尾。
*   **邏輯單元**: 涵蓋所有使GUI“活起來”的動態邏輯，包括**異步回饋處理、使用者交互事件**（點擊、勾選、刪除、預覽等），以及最終的**主程式入口** (`main` 函式和 `if __name__ == '__main__':` 區塊)。
*   **交付標誌**: 交付一個功能完整、可交互、可執行的最終應用程式。